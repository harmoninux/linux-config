#!/bin/sh

# Save current stty settings
oldstty=$(stty -g)

# Set terminal to raw mode, no echo
stty raw -echo

# Send the escape sequence to request cursor position
printf '\0337\033[r\033[999;999H\033[6n'

# Read the response: ESC [ rows ; cols R
# Read first two bytes (ESC and [)
c1=$(dd bs=1 count=1 2>/dev/null)
c2=$(dd bs=1 count=1 2>/dev/null)

rows=""
cols=""
if [ "$c1$c2" = "$(printf '\033[')" ]; then
    # Read rows (until ';')
    while :; do
        c=$(dd bs=1 count=1 2>/dev/null)
        [ "$c" = ";" ] && break
        rows="${rows}${c}"
    done
    # Read cols (until 'R')
    while :; do
        c=$(dd bs=1 count=1 2>/dev/null)
        [ "$c" = "R" ] && break
        cols="${cols}${c}"
    done
fi

# Restore terminal settings
stty "$oldstty"

# Set terminal cols
[ -n "$cols" ] && stty cols "$cols"

# Optionally print values
echo "Rows: $rows"
echo "Cols: $cols"
